---
metadata:
  name: "NSG: Ensure subnet is associated with NSG"  
  id: "NSG"
  guidelines: |
    Every subnet should be associated with NSG for controlling access to 
    resources within the subnet.
  category: "networking"
  severity: "high"
scope:
  provider: "azure" 
definition:
  or:
    - and:
      - cond_type: "attribute"
        resource_types:
          - "azurerm_virtual_network"
        attribute: "subnet"
        operator: "exists"
      - cond_type: "attribute"
        resource_types:
          - "azurerm_virtual_network"
        attribute: "subnet"
        operator: "contains"
        value: "security_group" 
    # - and:
    #   - cond_type: "connection"
    #     resource_types:
    #     - "azurerm_subnet_network_security_group_association"
    #     connected_resource_types: 
    #     - "azurerm_subnet"
    #     - "azurerm_network_security_group"
    #     operator: "exists"
    #   - cond_type: "filter"
    #     attribute: "resource_type"
    #     value:
    #     - "azurerm_subnet"
    #     operator: "within"