---
metadata:
  name: "NSG_FLOW_LOGS: Ensure Network Watcher Network Security Group (NSG) flow logs are enabled"
  id: "NSG_FLOW_LOGS"
  guidelines: |
    Network Security Group Flow Logs must be enabled on all NSGs attached critical resources 
    and ingested into approved SIEM solution.
  category: "networking"
  severity: "high"
scope:
  provider: "azure" 
definition:
  and:
    - cond_type: filter
      attribute: resource_type
      value:
        - azurerm_network_security_group
      operator: within
    - cond_type: connection
      operator: exists
      resource_types:
        - azurerm_network_security_group
      connected_resource_types:
        - azurerm_network_watcher_flow_log
    - cond_type: attribute
      operator: equals
      attribute: network_security_group_id
      resource_types:
        - azurerm_network_security_group
      value: "true"
    - cond_type: attribute
      operator: equals
      attribute: enabled
      resource_types:
        - azurerm_network_watcher_flow_log
      value: "true"